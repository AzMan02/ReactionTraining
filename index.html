<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ë°˜ì‘ í›ˆë ¨ Pro 2026</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#222222">
    <style>
        :root { --bg-color: #222; }
        body {
            margin: 0; padding: 0; display: flex; 
            background-color: var(--bg-color); color: white;
            transition: background-color 0.15s ease-out; 
            touch-action: none; overflow: hidden;
            font-family: system-ui, -apple-system, sans-serif;
        }

        /* ê³µí†µ ì„¤ì • */
        #info { 
            position: absolute; z-index: 10; 
            background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
            border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            text-align: center;
        }
        #direction-container {
            display: flex; align-items: center; justify-content: center;
            width: 100vw; height: 100vh;
        }
        #direction-text { font-weight: 900; user-select: none; line-height: 1; }
        .val { color: #fbc531; font-weight: bold; }
        #mic-status { font-weight: bold; display: block; margin-bottom: 4px; }

        /* [ì„¸ë¡œ ëª¨ë“œ ìµœì í™”] */
        @media (orientation: portrait) {
            body { flex-direction: column; }
            #info {
                top: env(safe-area-inset-top, 20px);
                width: 90%; left: 5%;
                padding: 15px 0;
                font-size: 1rem;
            }
            #direction-text { font-size: 70vw; } /* ë„ˆë¹„ ìœ„ì£¼ */
        }

        /* [ê°€ë¡œ ëª¨ë“œ ìµœì í™”] */
        @media (orientation: landscape) {
            body { flex-direction: row; }
            #info {
                bottom: env(safe-area-inset-bottom, 20px);
                left: 50%; transform: translateX(-50%);
                width: auto; min-width: 60%;
                padding: 10px 40px;
                font-size: 1.2rem;
                display: flex; justify-content: space-around; align-items: center;
            }
            #mic-status { margin-bottom: 0; margin-right: 15px; }
            #direction-text { font-size: 80vh; } /* ë†’ì´ ìœ„ì£¼ */
        }
    </style>
</head>
<body>

    <div id="info">
        <span id="mic-status" style="color: #ff4757;">ğŸ”´ í„°ì¹˜í•˜ì—¬ í™œì„±í™”</span>
        <div>ë§ì”€í•˜ì„¸ìš”: <span class="val">ì‹œì‘ / ì •ì§€ / Nì´ˆ</span></div>
        <div>ì„¤ì •: <span id="current-val" class="val">5</span>ì´ˆ (<span id="range-val" class="val">3~7</span>)</div>
    </div>

    <div id="direction-container">
        <div id="direction-text">READY</div>
    </div>

    <script>
        const directionDisplay = document.getElementById('direction-text');
        const currentValDisplay = document.getElementById('current-val');
        const rangeValDisplay = document.getElementById('range-val');
        const micStatus = document.getElementById('mic-status');
        
        let isRunning = false;
        let avgInterval = 5;
        let timer = null;
        let recognition = null;

        const directions = [
            { arrow: 'â†‘', label: 'ìœ„ë¡œ', color: '#2ecc71' },
            { arrow: 'â†“', label: 'ì•„ë˜ë¡œ', color: '#e74c3c' },
            { arrow: 'â†', label: 'ì™¼ìª½', color: '#3498db' },
            { arrow: 'â†’', label: 'ì˜¤ë¥¸ìª½', color: '#9b59b6' }
        ];

        // ìŒì„± ì¸ì‹ ì„¤ì • (Brave ëŠê¹€ ë°©ì§€ ë¡œì§ í¬í•¨)
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.lang = 'ko-KR';

            recognition.onresult = (event) => {
                const cmd = event.results[event.results.length - 1].transcript.trim();
                if (cmd.includes("ì‹œì‘")) { if (!isRunning) toggleTraining(true); }
                else if (cmd.includes("ì •ì§€") || cmd.includes("ë©ˆì¶°")) { if (isRunning) toggleTraining(false); }
                else if (cmd.includes("ì´ˆ")) {
                    const num = parseInt(cmd.replace(/[^0-9]/g, ""));
                    if (num >= 3) { avgInterval = num; updateUI(); speak(`${avgInterval}ì´ˆ ì„¤ì •`); }
                }
            };

            recognition.onstart = () => { 
                micStatus.textContent = "ğŸŸ¢ ìŒì„± ì¸ì‹ ì¤‘"; 
                micStatus.style.color = "#44bd32"; 
            };
            
            // ëŠê¸¸ ê²½ìš° ìë™ ì¬ì‹œì‘
            recognition.onend = () => { if (recognition) try { recognition.start(); } catch(e) {} };
        }

        function updateUI() {
            currentValDisplay.textContent = avgInterval;
            rangeValDisplay.textContent = `${avgInterval - 2}~${avgInterval + 2}`;
        }

        function runTraining() {
            if (!isRunning) return;
            const visual = directions[Math.floor(Math.random() * directions.length)];
            const audio = directions[Math.floor(Math.random() * directions.length)];
            
            directionDisplay.textContent = visual.arrow;
            document.body.style.backgroundColor = visual.color;

            if ("vibrate" in navigator) navigator.vibrate(100);
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(audio.label);
            u.lang = 'ko-KR'; u.rate = 1.4;
            window.speechSynthesis.speak(u);

            const nextTime = Math.floor(Math.random() * 4001) + (avgInterval - 2) * 1000;
            timer = setTimeout(runTraining, Math.max(1000, nextTime));
        }

        async function toggleTraining(start) {
            if (start) {
                isRunning = true;
                if ('wakeLock' in navigator) try { await navigator.wakeLock.request('screen'); } catch(e){}
                runTraining();
            } else {
                isRunning = false;
                clearTimeout(timer);
                window.speechSynthesis.cancel();
                directionDisplay.textContent = 'READY';
                document.body.style.backgroundColor = '#222';
            }
        }

        function speak(t) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(t);
            u.lang = 'ko-KR'; window.speechSynthesis.speak(u);
        }

        // í„°ì¹˜ ì‹œ ì‹œì‘ (Brave ê¶Œí•œ ëŒ€ì‘)
        window.addEventListener('touchstart', () => {
            if (recognition) {
                try { recognition.start(); speak("ë°˜ì‘ í›ˆë ¨ ì¤€ë¹„ ì™„ë£Œ"); } catch(e) {}
            }
        }, { once: true });
    </script>
</body>
</html>
